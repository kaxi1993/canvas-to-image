var canvasToImage=canvasToImage||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=t||function(){var t=e.document,n=function(){return e.URL||e.webkitURL||e},a=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in a,o=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},i=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),c=e.webkitRequestFileSystem,u=e.requestFileSystem||c||e.mozRequestFileSystem,f=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},d="application/octet-stream",s=0,l=4e4,p=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,l)},v=function(e,t,n){t=[].concat(t);for(var a=t.length;a--;){var r=e["on"+t[a]];if("function"==typeof r)try{r.call(e,n||e)}catch(o){f(o)}}},g=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["ï»¿",e],{type:e.type}):e},m=function(t,f,l){l||(t=g(t));var m,w,y,h=this,b=t.type,S=!1,R=function(){v(h,"writestart progress write writeend".split(" "))},O=function(){if(w&&i&&"undefined"!=typeof FileReader){var a=new FileReader;return a.onloadend=function(){var e=a.result;w.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),h.readyState=h.DONE,R()},a.readAsDataURL(t),void(h.readyState=h.INIT)}if((S||!m)&&(m=n().createObjectURL(t)),w)w.location.href=m;else{var r=e.open(m,"_blank");void 0===r&&i&&(e.location.href=m)}h.readyState=h.DONE,R(),p(m)},E=function(e){return function(){return h.readyState!==h.DONE?e.apply(this,arguments):void 0}},I={create:!0,exclusive:!1};return h.readyState=h.INIT,f||(f="download"),r?(m=n().createObjectURL(t),void setTimeout(function(){a.href=m,a.download=f,o(a),R(),p(m),h.readyState=h.DONE})):(e.chrome&&b&&b!==d&&(y=t.slice||t.webkitSlice,t=y.call(t,0,t.size,d),S=!0),c&&"download"!==f&&(f+=".download"),(b===d||c)&&(w=e),u?(s+=t.size,void u(e.TEMPORARY,s,E(function(e){e.root.getDirectory("saved",I,E(function(e){var n=function(){e.getFile(f,I,E(function(e){e.createWriter(E(function(n){n.onwriteend=function(t){w.location.href=e.toURL(),h.readyState=h.DONE,v(h,"writeend",t),p(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&O()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=h["on"+e]}),n.write(t),h.abort=function(){n.abort(),h.readyState=h.DONE},h.readyState=h.WRITING}),O)}),O)};e.getFile(f,{create:!1},E(function(e){e.remove(),n()}),E(function(e){e.code===e.NOT_FOUND_ERR?n():O()}))}),O)}),O)):void O())},w=m.prototype,y=function(e,t,n){return new m(e,t,n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return n||(e=g(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(w.abort=function(){var e=this;e.readyState=e.DONE,v(e,"abort")},w.readyState=w.INIT=0,w.WRITING=1,w.DONE=2,w.error=w.onwritestart=w.onprogress=w.onwrite=w.onabort=w.onerror=w.onwriteend=null,y)}(),n=function(e,t,n){t=t||"",n=n||512;for(var a=atob(e),r=[],o=0;o<a.length;o+=n){for(var i=a.slice(o,o+n),c=new Array(i.length),u=0;u<i.length;u++)c[u]=i.charCodeAt(u);var f=new Uint8Array(c);r.push(f)}var d=new Blob(r,{type:t});return d},a=function(e,a,r){a+=".jpg";var o=e.toDataURL("image/jpeg",r);o=o.replace(/^data:image\/jpeg;base64,/,"");var i=n(o,"image/jpeg");t(i,a)},r=function(e,a,r){a+=".png";var o=e.toDataURL("image/png",r);o=o.replace(/^data:image\/png;base64,/,"");var i=n(o,"image/png");t(i,a)},o=function(e,t,n){var o;"object"==typeof t?(name=t.name||"image",n=t.type||"png",o=t.quality||1):(name=t||"image",n=n||"png");var i=document.getElementById(e);switch(n=n.toLowerCase()){case"jpg":a(i,name,o);break;case"png":r(i,name,o);break;default:r(i,name,o)}};return o}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports=canvasToImage:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return canvasToImage});
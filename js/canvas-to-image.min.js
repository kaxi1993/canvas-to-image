var canvasToImage=canvasToImage||function(l){"use strict";var r,e,p,m,g,y,w,v,i,h,S,t,c;if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent))return r=r||(e=l.document,p=function(){return l.URL||l.webkitURL||l},m=e.createElementNS("http://www.w3.org/1999/xhtml","a"),g="download"in m,y=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),w=l.webkitRequestFileSystem,v=l.requestFileSystem||w||l.mozRequestFileSystem,i=function(e){(l.setImmediate||l.setTimeout)(function(){throw e},0)},h="application/octet-stream",S=0,t=4e4,e=o.prototype,"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return n||(e=O(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(e.abort=function(){this.readyState=this.DONE,b(this,"abort")},e.readyState=e.INIT=0,e.WRITING=1,e.DONE=2,e.error=e.onwritestart=e.onprogress=e.onwrite=e.onabort=e.onerror=e.onwriteend=null,function(e,t,n){return new o(e,t,n)})),c=function(e,t,n){t=t||"",n=n||512;for(var o=atob(e),a=[],r=0;r<o.length;r+=n){for(var i=o.slice(r,r+n),c=new Array(i.length),f=0;f<i.length;f++)c[f]=i.charCodeAt(f);var u=new Uint8Array(c);a.push(u)}return new Blob(a,{type:t})},function(e,t,n){"object"==typeof t?(name=t.name||"image",n=t.type||"png",o=t.quality||1):(name=t||"image",n=n||"png");var o,a,t=(t=e)instanceof Element||t instanceof HTMLDocument?e:document.getElementById(e);"jpg"!==(n=n.toLowerCase())?(e=t,n=name,a=o,n+=".png",e=(e=t.toDataURL("image/png",a)).replace(/^data:image\/png;base64,/,""),a=c(e,"image/png"),r(a,n)):(e=t,a=name,n=o,a+=".jpg",e=(e=t.toDataURL("image/jpeg",n)).replace(/^data:image\/jpeg;base64,/,""),n=c(e,"image/jpeg"),r(n,a))};function R(e){setTimeout(function(){"string"==typeof e?p().revokeObjectURL(e):e.remove()},t)}function b(e,t,n){for(var o=(t=[].concat(t)).length;o--;){var a=e["on"+t[o]];if("function"==typeof a)try{a.call(e,n||e)}catch(e){i(e)}}}function O(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["ï»¿",e],{type:e.type}):e}function o(o,n,e){function a(){var t;c&&y&&"undefined"!=typeof FileReader?((t=new FileReader).onloadend=function(){var e=t.result;c.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),f.readyState=f.DONE,d()},t.readAsDataURL(o),f.readyState=f.INIT):(!u&&i||(i=p().createObjectURL(o)),c?c.location.href=i:void 0===l.open(i,"_blank")&&y&&(l.location.href=i),f.readyState=f.DONE,d(),R(i))}function r(e){return function(){if(f.readyState!==f.DONE)return e.apply(this,arguments)}}e||(o=O(o));var i,c,t,f=this,e=o.type,u=!1,d=function(){b(f,"writestart progress write writeend".split(" "))},s={create:!0,exclusive:!1};f.readyState=f.INIT,n=n||"download",g?(i=p().createObjectURL(o),setTimeout(function(){var e,t;m.href=i,m.download=n,e=m,t=new MouseEvent("click"),e.dispatchEvent(t),d(),R(i),f.readyState=f.DONE})):(l.chrome&&e&&e!==h&&(t=o.slice||o.webkitSlice,o=t.call(o,0,o.size,h),u=!0),w&&"download"!==n&&(n+=".download"),e!==h&&!w||(c=l),v?(S+=o.size,v(l.TEMPORARY,S,r(function(e){e.root.getDirectory("saved",s,r(function(e){function t(){e.getFile(n,s,r(function(n){n.createWriter(r(function(t){t.onwriteend=function(e){c.location.href=n.toURL(),f.readyState=f.DONE,b(f,"writeend",e),R(n)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&a()},"writestart progress write abort".split(" ").forEach(function(e){t["on"+e]=f["on"+e]}),t.write(o),f.abort=function(){t.abort(),f.readyState=f.DONE},f.readyState=f.WRITING}),a)}),a)}e.getFile(n,{create:!1},r(function(e){e.remove(),t()}),r(function(e){(e.code===e.NOT_FOUND_ERR?t:a)()}))}),a)}),a)):a())}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports=canvasToImage:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return canvasToImage});

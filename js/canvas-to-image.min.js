var canvasToImage=canvasToImage||function(p){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var e,m,g,v,w,y,h,S,t,i=i||(e=p.document,m=e.createElementNS("http://www.w3.org/1999/xhtml","a"),g="download"in m,v=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),w=p.webkitRequestFileSystem,y=p.requestFileSystem||w||p.mozRequestFileSystem,h="application/octet-stream",S=0,t=a.prototype,"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return n||(e=E(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(t.abort=function(){this.readyState=this.DONE,O(this,"abort")},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,function(e,t,n){return new a(e,t,n)})),c=function(e,t,n){t=t||"",n=n||512;for(var a=atob(e),o=[],r=0;r<a.length;r+=n){for(var i=a.slice(r,r+n),c=new Array(i.length),f=0;f<i.length;f++)c[f]=i.charCodeAt(f);var u=new Uint8Array(c);o.push(u)}return new Blob(o,{type:t})};return function(e,t,n){var a;"object"==typeof t?(name=t.name||"image",n=t.type||"png",a=t.quality||1):(name=t||"image",n=n||"png");var o,r=(o=e)instanceof Element||o instanceof HTMLDocument?e:document.getElementById(e);switch(n=n.toLowerCase()){case"jpg":!function(e,t,n){t+=".jpg";var a=e.toDataURL("image/jpeg",n);a=a.replace(/^data:image\/jpeg;base64,/,"");var o=c(a,"image/jpeg");i(o,t)}(r,name,a);break;default:!function(e,t,n){t+=".png";var a=e.toDataURL("image/png",n);a=a.replace(/^data:image\/png;base64,/,"");var o=c(a,"image/png");i(o,t)}(r,name,a)}}}function b(){return p.URL||p.webkitURL||p}function r(e){(p.setImmediate||p.setTimeout)(function(){throw e},0)}function R(e){setTimeout(function(){"string"==typeof e?b().revokeObjectURL(e):e.remove()},4e4)}function O(e,t,n){for(var a=(t=[].concat(t)).length;a--;){var o=e["on"+t[a]];if("function"==typeof o)try{o.call(e,n||e)}catch(e){r(e)}}}function E(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["ï»¿",e],{type:e.type}):e}function a(a,n,e){function o(){O(u,"writestart progress write writeend".split(" "))}function r(){if(f&&v&&"undefined"!=typeof FileReader){var t=new FileReader;return t.onloadend=function(){var e=t.result;f.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),u.readyState=u.DONE,o()},t.readAsDataURL(a),void(u.readyState=u.INIT)}!s&&c||(c=b().createObjectURL(a)),f?f.location.href=c:void 0===p.open(c,"_blank")&&v&&(p.location.href=c),u.readyState=u.DONE,o(),R(c)}function i(e){return function(){if(u.readyState!==u.DONE)return e.apply(this,arguments)}}e||(a=E(a));var c,f,t,u=this,d=a.type,s=!1,l={create:!0,exclusive:!1};if(u.readyState=u.INIT,n=n||"download",g)return c=b().createObjectURL(a),void setTimeout(function(){var e,t;m.href=c,m.download=n,e=m,t=new MouseEvent("click"),e.dispatchEvent(t),o(),R(c),u.readyState=u.DONE});p.chrome&&d&&d!==h&&(t=a.slice||a.webkitSlice,a=t.call(a,0,a.size,h),s=!0),w&&"download"!==n&&(n+=".download"),d!==h&&!w||(f=p),y?(S+=a.size,y(p.TEMPORARY,S,i(function(e){e.root.getDirectory("saved",l,i(function(e){function t(){e.getFile(n,l,i(function(n){n.createWriter(i(function(t){t.onwriteend=function(e){f.location.href=n.toURL(),u.readyState=u.DONE,O(u,"writeend",e),R(n)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&r()},"writestart progress write abort".split(" ").forEach(function(e){t["on"+e]=u["on"+e]}),t.write(a),u.abort=function(){t.abort(),u.readyState=u.DONE},u.readyState=u.WRITING}),r)}),r)}e.getFile(n,{create:!1},i(function(e){e.remove(),t()}),i(function(e){(e.code===e.NOT_FOUND_ERR?t:r)()}))}),r)}),r)):r()}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports=canvasToImage:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return canvasToImage});